/* Appnima v0.5.03 - 2013/5/3
   http://tapquo.com
   Copyright (c) 2013 Tapquo S.L. - Licensed GPLv3 */
(function(){var n,e=[].slice;window.Appnima=n={};n.version="0.1.0503";n.key=null;n.token=null;n.Dom=function(){var n;n=1<=arguments.length?e.call(arguments,0):[];if(typeof $$!=="undefined"&&$$!==null){return $$.apply(null,n)}else{return $.apply(null,n)}};n.Dom(document).ready(function(){return console.log("SESSION :",n.User.session())})}).call(this);(function(){Appnima.connect=function(n,e,t,r){var i,o,a=this;if(r==null){r=false}i={};if(r&&Appnima.key!=null){i={Authorization:"basic "+Appnima.key}}if(!r&&Appnima.token){i={Authorization:"bearer "+Appnima.token}}o=new Hope.Promise;$$.ajax({url:e,type:n,headers:i,data:t,dataType:"json",contentType:"application/x-www-form-urlencoded",success:function(n){if(n){return o.done(null,n)}else{return o.done("Unknown error",null)}},error:function(n,e,t){var r;r={code:e.status,type:e.statusText,message:JSON.parse(e.response).message};return o.done(r,null)}});return o}}).call(this);(function(){Appnima.Location=function(n){return this}(Appnima)}).call(this);(function(){Appnima.Messenger=function(n){return this}(Appnima)}).call(this);(function(){Appnima.Network=function(n){var e,t,r,i,o,a,u,l,s;s="http://192.168.1.181:1181/";o=function(e){var t;t=e?{user:e}:null;return n.connect("GET",""+s+"api/relationship/stats",t)};i=function(e){var t;t=e?{user:e}:null;return n.connect("GET",""+s+"api/relationship/following",t)};r=function(e){var t;t=e?{user:e}:null;return n.connect("GET",""+s+"api/relationship/followers",t)};t=function(n){return l("follow",n)};e=function(n){return l("check",n)};a=function(n){return l("unfollow",n)};l=function(e,t){var r;r=new Hope.Promise;if(t){n.connect("POST",""+s+"api/user/"+e,{user:t}).then(r.done)}else{r.done({code:1,message:"Insuficient parameters",type:"Client"},null)}return r};u=function(n){return this};return{info:o,following:i,followers:r,check:e,follow:t,unfollow:a}}(Appnima)}).call(this);(function(){Appnima.Push=function(n){return this}(Appnima)}).call(this);(function(){Appnima.Socket=function(n){return this}(Appnima)}).call(this);(function(){Appnima.User=function(n){var e,t,r,i,o,a,u,l=this;u="http://192.168.1.181:1181/";i=function(n,e,t){var r;r={mail:n,password:e,username:t!=null?t:n};return o("signup",r)};t=function(n,e){var t;t={mail:n,password:e};return o("login",t)};e=function(e){if(!e){return n.connect("GET",""+u+"api/user")}else{return n.connect("PUT",""+u+"api/user",e)}};r=function(){var e;e=localStorage.getItem(n.key);if(e){e=JSON.parse(localStorage.getItem(n.key));Appnima.token=e.access_token;n.connect("GET",""+u+"api/user").then(function(n,t){return a(t,e)})}return e};o=function(e,t){var r;r=new Hope.Promise;Hope.shield([function(){localStorage.removeItem(n.key);return n.connect("POST",""+u+"api/"+e,t)},function(e,r){l.credentials=r;t.grant_type="password";return n.connect("POST",""+u+"oauth2/token",t,true)}]).then(function(n,e){if(!n){a(l.credentials,e);return r.done(null,{_id:l.credentials._id,avatar:l.credentials.avatar,mail:l.credentials.mail,name:l.credentials.name,username:l.credentials.username})}else{return r.done(n,null)}});return r};a=function(e,t){e.access_token=t.access_token;e.refresh_token=t.refresh_token;localStorage.setItem(n.key,JSON.stringify(e));return Appnima.token=e.access_token};return{signup:i,login:t,info:e,session:r}}(Appnima)}).call(this);